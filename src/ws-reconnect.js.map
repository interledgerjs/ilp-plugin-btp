{"version":3,"file":"ws-reconnect.js","sourceRoot":"","sources":["ws-reconnect.ts"],"names":[],"mappings":";;AAAA,gCAA+B;AAC/B,+BAA8B;AAC9B,iDAA6C;AAC7C,MAAM,KAAK,GAAG,KAAK,CAAC,kBAAkB,CAAC,CAAA;AAEvC,MAAM,0BAA0B,GAAG,IAAI,CAAA;AAMvC,0BAAkC,SAAQ,6BAAa;IAOrD,YAAa,OAA+C;QAC1D,KAAK,EAAE,CAAA;QACP,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAA;IAC3C,CAAC;IAED,IAAI,CAAE,GAAW;QACf,IAAI,CAAC,IAAI,GAAG,GAAG,CAAA;QACf,IAAI,CAAC,SAAS,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACzC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAA;QACvD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAY,EAAE,MAAc,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAA;QACnF,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAU,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAA;QAChE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,IAAoB,EAAE,EAAE,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAA;IACzF,CAAC;IAGD,IAAI,CAAE,IAAS,EAAE,EAAyB;QACxC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;IACtC,CAAC;IAED,KAAK;QACH,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAA;QACnC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAA;IAC/B,CAAC;IAEO,UAAU,CAAE,WAA2B;QAC7C,KAAK,CAAC,+BAA+B,WAAW,kBAAkB,IAAI,CAAC,SAAS,EAAE,CAAC,CAAA;QACnF,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;QACvB,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAA;QACnC,UAAU,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACtB,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAA;IACpB,CAAC;CACF;AAvCD,oDAuCC","sourcesContent":["import * as WebSocket from 'ws'\nimport * as Debug from 'debug'\nimport { EventEmitter2 } from 'eventemitter2'\nconst debug = Debug('ilp-ws-reconnect')\n\nconst DEFAULT_RECONNECT_INTERVAL = 5000\n\nexport interface WebSocketReconnectorConstructorOptions {\n  interval?: number\n}\n\nexport class WebSocketReconnector extends EventEmitter2 {\n\n  private _interval: number\n  private _url: string\n  private _instance: WebSocket\n  private _connected: boolean\n\n  constructor (options: WebSocketReconnectorConstructorOptions) {\n    super()\n    this._interval = options.interval || 5000\n  }\n\n  open (url: string) {\n    this._url = url\n    this._instance = new WebSocket(this._url)\n    this._instance.on('open', () => void this.emit('open'))\n    this._instance.on('close', (code: number, reason: string) => this._reconnect(code))\n    this._instance.on('error', (err: Error) => this._reconnect(err))\n    this._instance.on('message', (data: WebSocket.Data) => void this.emit('message', data))\n  }\n\n  // uses callback to match normal ws api\n  send (data: any, cb?: (err: Error) => void): void {\n    return this._instance.send(data, cb)\n  }\n\n  close () {\n    this._instance.removeAllListeners()\n    return this._instance.close()\n  }\n\n  private _reconnect (codeOrError: number | Error) {\n    debug(`websocket disconnected with ${codeOrError}; reconnect in ${this._interval}`)\n    this._connected = false\n    this._instance.removeAllListeners()\n    setTimeout(() => {\n      this.open(this._url)\n    }, this._interval)\n  }\n}\n"]}